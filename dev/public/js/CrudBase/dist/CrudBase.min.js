class AutoSave{constructor(t,e){this.msgElm=jQuery("#"+t),this.data,this.set_timeout_hdl,this.csrf_token=e}saveRequest(t,e,i,a){this.data=t,this.auto_save_url=e,this.afterCallBack=i,null==a&&(a={}),null==a.interval&&(a.interval=3e3),this.option=a,null!=this.set_timeout_hdl&&clearTimeout(this.set_timeout_hdl),this.set_timeout_hdl=setTimeout((()=>{this._autoSave(this.data)}),a.interval)}_autoSave(t){this.msgElm.html("保存中..."),t=this._escapeForAjax(t);let e=JSON.stringify(t),i=this.auto_save_url,a=new FormData;a.append("key1",e),a.append("_token",this.csrf_token),jQuery.ajax({type:"post",url:i,data:a,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{let i;try{i=jQuery.parseJSON(t),this.msgElm.html("")}catch(e){return this.msgElm.html("自動保存のエラー1"),void jQuery("#err").html(t)}this.afterCallBack&&this.afterCallBack()})).fail(((t,e,i)=>{this.msgElm.html("自動保存のエラー"),console.log(t),jQuery("#err").html(t.responseText)}))}_escapeForAjax(t){if("string"==typeof t)return-1!=t.indexOf("&")?(t=t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),encodeURIComponent(t)):t;if("object"==typeof t){for(var e in t)t[e]=this._escapeForAjax(t[e]);return t}return t}}class BaseXHelper{constructor(){}openNoteDetail(t,e){t instanceof jQuery||(t=jQuery(t)),null==e&&(e="note");var i=t.parents("td"),a=(i.find("[name='"+e+"']"),i.find("."+e)),r=1,s=i.find(".note_detail");if(!s[0]){r=0;var n=`<div class='note_detail' data-field='${e}'></div>`;i.append(n),s=i.find(".note_detail")}if("none"==a.css("display"))return a.show(),s.hide(),void t.val("...");if(r)return a.hide(),s.show(),void t.val("閉じる");var l=i.find("[name='"+e+"']").val();null!=l&&""!=l&&(l=(l=this._xssSanitaizeEncode(l)).replace(/\r\n|\n\r|\r|\n/g,"<br>"),s.html(l),a.hide(),t.val("閉じる"))}_xssSanitaizeEncode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeEncode(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_xssSanitaizeDecode(t){if("object"==typeof t){for(var e in t)t[e]=this._xssSanitaizeDecode(t[e]);return t}return"string"==typeof t?t.replace(/&lt;/g,"<").replace(/&gt;/g,">"):t}}
/**
 * 列表示切替クラス 
 * 
 * 初期化(init)を実行すると、対象HTMLテーブルの列から、列表示切替チェックボックスを自動生成します。
 * 列表示切替チェックボックスにチェックを入れると列の表示を切り替えられます。
 * 
 * ◇主なメソッド
 * - init 初期化
 * - refresh 一覧テーブルをリフレッシュする
 * 
 * @version 1.6.3
 * @date 2014-4-1 │ 2022-7-7
 * @license MIT
 * @author k-uehara 
 */var ClmShowHide=function(){var t=this;function e(e,i){var a=jQuery("#"+t.props.chBoxsId);for(var r in t.defClmData){var s=t.defClmData[r].show_flg,n=a.find("[index="+r+"]");n[0]&&(1==s?(n.prop("checked",!0),t.clm_show_csh(e,r)):0==s&&(n.prop("checked",!1),t.clm_hide_csh(e,r)))}var l=localStorage,h=t._getLsKey();l.removeItem(h)}function i(){var e=jQuery("#"+t.props.chBoxsId),i=t.actClmData;for(var a in i){var r=e.find("[index="+a+"]");if(r[0]){var s=r.prop("checked");i[a].show_flg=1==s?1:0}}return i}this.props={},this.defClmData={},this.actClmData={},this.init=function(a,r,s){this.props.tblId=a,this.props.chBoxsId=r;for(var n=[],l=0;l<s.length;l++){var h={clm_name:null,show_flg:s[l]};n[l]=h}l=0;$.each(jQuery("#"+a+" thead tr th"),(function(){var t=jQuery(this).html();try{n[l].clm_name=t}catch(t){return}l++}));var c=this._getLsKey(),o=localStorage.getItem(c),_={};for(var l in _=""==o||null==o?$.extend(!0,{},n):JSON.parse(o),this.defClmData=n,this.actClmData=_,_=function(t){for(let e in t){let i=t[e],a=i.clm_name;null==a&&(a=""),i.clm_name=a.replace(/<("[^"]*"|'[^']*'|[^'">])*>/g,"")}return t}(_),function(t,e,i){var a=jQuery("#"+e);for(var r in a.empty(),i){var s=i[r];if(-1==s.show_flg)continue;var n="";1==s.show_flg&&(n="checked");let t="csh_cb"+r;var l="<div class='csh_cb_div'><input id='"+t+"' type='checkbox' class='csh_cb' "+n+" index='"+r+"' /><label for='"+t+"'>"+s.clm_name+"</label></div>";a.append(l)}a.append("<div style='clear:both'></div>");var h="<div class='csh_func_btn'><input type='button' value='列表示を保存' id='"+t+"_save_btn' class='btn btn-primary btn-sm' /></div>";a.append(h);var c="<div class='csh_func_btn'><input type='button' value='すべてチェック' id='"+t+"_all_checked_btn' class='btn btn-primary btn-sm' /></div>";a.append(c);var o="<div class='csh_func_btn'><input type='button' value='すべてはずす' id='"+t+"_all_uncheck_btn' class='btn btn-primary btn-sm' /></div>";a.append(o);var _="<div class='csh_func_btn'><input type='button' value='初期に戻す' id='"+t+"_default_btn' class='btn btn-primary btn-sm' /></div>";a.append(_),a.append("<div id='csh_msg' class='csh_func_btn' style='display:none;color:#de5246'>列の表示状態を記憶しました。</div>")}(a,r,_),jQuery(".csh_cb").click((function(e){var i=jQuery(this).prop("checked"),r=jQuery(this).attr("index");1==i?t.clm_show_csh(a,r):t.clm_hide_csh(a,r)})),_){0==(h=_[l]).show_flg&&this.clm_hide_csh(a,l)}jQuery("#"+a+"_save_btn").click((function(e){!function(e,a){var r=i(),s=JSON.stringify(r),n=t._getLsKey();localStorage.setItem(n,s),jQuery("#csh_msg").show(),jQuery("#csh_msg").fadeOut(3e3)}()})),jQuery("#"+a+"_all_checked_btn").click((function(e){!function(e,i,a){var r=jQuery("#"+t.props.chBoxsId);for(var s in a){var n=r.find("[index="+s+"]");if(n[0])0==n.prop("checked")&&(n.prop("checked",!0),t.clm_show_csh(e,s))}}(a,0,t.actClmData)})),jQuery("#"+a+"_all_uncheck_btn").click((function(e){!function(e,i,a){var r=jQuery("#"+t.props.chBoxsId);for(var s in a){var n=r.find("[index="+s+"]");if(n[0])1==n.prop("checked")&&(n.prop("checked",!1),t.clm_hide_csh(e,s))}}(a,0,t.actClmData)})),jQuery("#"+a+"_default_btn").click((function(t){e(a,r)}))},this._getLsKey=function(){let t=location.href;return t=t.split(/[?#]/)[0],t+="_csh162",t},this.getCshAry=function(){var e=jQuery("#"+t.props.chBoxsId),i=[];for(var a in this.defClmData){var r=e.find("[index="+a+"]");if(r[0])1==r.prop("checked")?i.push(1):i.push(0)}return i},this.reset=function(){e(this.props.tblId,this.props.chBoxsId)},this.refresh=function(){var t=this.props.tblId;for(var e in this.defClmData)this.clm_show_csh(t,e);var a=i();for(var e in a){var r=a[e].show_flg;1==r?this.clm_show_csh(t,e):0==r&&this.clm_hide_csh(t,e)}},this.clm_show_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).show(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).show()}))},this.clm_hide_csh=function(t,e){jQuery("#"+t+" thead tr th").eq(e).hide(),$.each(jQuery("#"+t+" tbody tr"),(function(){jQuery(this).children().eq(e).hide()}))}};class CsvExinL9{init(t,e){this.mainElm=jQuery("#csv_exin"),this.csvFieldData=t,this.csvParam=this._setParamIfEmpty(e),this.data;let i="checked",a="";"shift-jis"==e.def_checked&&(i="",a="checked");var r=`\n\t\t\t<div id="csv_exin_err" style="color:red"></div>\n\t\t\t<div id="csv_exin_msg" class="text-success"></div>\n\t\t\t<div id="csv_exin_step1">\n\t<label><input type="radio" name="csv_exin_str_code" value='utf-8' ${i} />UTF-8</label>\n\t\t\t\t<label style="font-weight:normal;color:#808080" title="iosの波ダッシュ「〜」はWindowsのShift-jisにおいて文字化けします。">\n\t\t\t\t\t<input type="radio" name="csv_exin_str_code" value='Shift_JIS' ${a} />Shift-JIS(旧Excel用CSV)</label>\n\t\t\t\t<input id="csv_exin_file" type="file" multiple >\n\t\t\t</div>\n\t\t\t<aside>基本的に上書きでDB登録されますが、idが空のレコードもしくはDBに存在しないidのレコードは「新規追加」になります。</aside>\n\t\t\t<div id="csv_exin_step2" style="display:none">\n\t\t\t\t<input id="csv_bulk_reg_btn" type="button" value="一括登録" class="btn btn-danger btn-sm" />\n\t\t\t\t<input id="csv_exin_retry_btn" type="button" value="キャンセル" class="btn btn-outline-secondary btn-sm" />\n\t\t\t</div>\n\t\t\t<div id="csv_exin_data_count"></div>\n\t\t\t<div id="csv_exin_preview" style="overflow:auto;height:400px;display:none"></div>\n\t\t`;this.mainElm.html(r),this.jq_csv_exin_err=this.mainElm.find("#csv_exin_err"),this.jq_csv_exin_msg=this.mainElm.find("#csv_exin_msg"),this.jq_csv_exin_step1=this.mainElm.find("#csv_exin_step1"),this.jq_csv_exin_file=this.mainElm.find("#csv_exin_file"),this.jq_csv_exin_step2=this.mainElm.find("#csv_exin_step2"),this.jq_csv_exin_data_count=this.mainElm.find("#csv_exin_data_count"),this.bulkRegBtn=this.mainElm.find("#csv_bulk_reg_btn"),this._addEventStrCodeRadioClick(),this._addEventRetryBtn(),this._addEventFileChange(),this._addEventBulkReg()}_setParamIfEmpty(t){return null==t&&(t={}),null==t.ajax_url&&(t.ajax_url="dummy"),t}_addEventFileChange(){this.jq_csv_exin_file.change((t=>{this.jq_csv_exin_msg.html("CSVファイルを読込中です...");var e=t.target.files[0],i=new FileReader;i.readAsText(e,this.csvParam.str_code),i.onload=t=>{this.jq_csv_exin_msg.html("");var e=t.target.result;this._preview(e)}}))}_addEventBulkReg(){this.mainElm.find("#csv_bulk_reg_btn").click((t=>{this._bulkReg()}))}_preview(t){var e=this.csvFieldData,i=this.csvParam;this._errShow(""),this.jq_csv_exin_step1.hide(),this.jq_csv_exin_step2.show();var a=this._csvTextToData(t),r=this._checkD2ary(a);if(r)this._errShow(r);else{var s=this._getClmHederFlgEtc(a,e);i.clm_header_flg=s.clm_header_flg,i.id_clm_flg=s.id_clm_flg;var n=a[0],l=this._makeIndexHashmap(n,e);if(r=this._checkClmName(n,e,l))this._errShow(r);else{var h=this._createDataFromD2ary(a,e,l);this.data=h;var c=$.extend(!0,{},h);c=this._xss_sanitize(c);var o=this._makeTableHtml(c,e,l),_=this.mainElm.find("#csv_exin_preview");_.show(),_.html(o),this.jq_csv_exin_data_count.html(h.length+"件"),this.bulkRegBtn.show()}}}_getClmHederFlgEtc(t,e){var i={clm_header_flg:0,id_clm_flg:0},a=t[0][0];return 0==isNaN(a)?(i.id_clm_flg=1,i):"id"==a.toLowerCase()?(i.clm_header_flg=1,i.id_clm_flg=1,i):a==e[1].clm_name?(i.clm_header_flg=1,i):i}_createDataFromD2ary(t,e,i){var a=[];for(var r in t)if(0!=r){var s=t[r],n={};for(var l in i){var h=e[i[l]].field,c=s[l];n[h]=c}a.push(n)}return a}_makeIndexHashmap(t,e){var i={};for(var a in t){var r=t[a];for(var s in r=r.trim(),e){var n=e[s];if(n.clm_name==r)i[a]=s;else{if(null==n.clm_alias_names)continue;for(var l in n.clm_alias_names){var h=n.clm_alias_names[l];null!=h&&""!=h&&(h!=r||(i[a]=s))}}}}return i}_checkClmName(t,e,i){var a=null;for(var r in t){var s=t[r],n=0;for(var l in t){s==t[l]&&n++}if(n>=2)return a="列名「"+s+"」が重複しています。同じ列名は使えません"}var h={};for(var c in i){h[_=i[c]]=c}var o=[];for(var _ in e)if(null==h[_]){var d=e[_];1==d.req_flg&&o.push(d.clm_name)}o.length>0&&(a="次の列名は必須です。→"+o.join(","));return a}_addEventStrCodeRadioClick(){this.mainElm.find("input[name='csv_exin_str_code']").click((t=>{var e=$(t.currentTarget);this.csvParam.str_code=e.val(),this.jq_csv_exin_file.prop("disabled",!1)}))}_addEventRetryBtn(){this.mainElm.find("#csv_exin_retry_btn").click((t=>{this.jq_csv_exin_file.val(""),this.jq_csv_exin_step1.show(),this.jq_csv_exin_step2.hide(),this.jq_csv_exin_err.html("");var e=this.mainElm.find("#csv_exin_preview");e.hide(),e.html("")}))}_csvTextToData(t){if(""==t||null==t)return null;t[t.length-1].match(/\r|\n/)||(t+="\n");for(var e=[],i=t.length,a=0,r="",s=[],n=0;n<i;n++){var l=t[n];if(0==a)if('"'==l)a=1;else if(","==l)s.push(r),r="";else if(l.match(/\r|\n/)){if(s.push(r),e.push(s),r="",s=[],n<i-1)t[n+1].match(/\r|\n/)&&n++}else r+=l;else if('"'==l){if(n<i-1)'""'==l+t[n+1]?(r+='"',n++):a=0}else r+=l}return e}_checkD2ary(t){return null==t||0==t.length?"CSVのデータが空です。":0==t[0].length||1==t[0].length?"対象のCSVファイルではありません。":null}_makeTableHtml(t,e,i){var a="<table id='csv_exin_table' class='tbl2' style='white-space:nowrap;'>";for(var r in a+="<thead><tr>",i){a+="<th>"+e[i[r]].clm_name+"</th>"}for(var s in a+="</tr></thead><tbody>",t){var n=t[s];for(var l in a+="<tr>",n){var h=n[l];"string"==typeof h&&(h=h.replace(/\r\n|\r|\n/g,"<br>")),null==h&&(h=""),a+="<td>"+h+"</td>"}a+="</tr>"}return a+="</tbody></table>"}_xss_sanitize(t){if("object"==typeof t){for(var e in t)t[e]=this._xss_sanitize(t[e]);return t}return"string"==typeof t?t.replace(/</g,"&lt;").replace(/>/g,"&gt;"):t}_errShow(t){this.jq_csv_exin_err.html(t),this.bulkRegBtn.hide()}_bulkReg(){var t=this.csvParam,e=this.data;let i=new FormData;var a={data:e=this._ampTo26(e),csvFieldData:this.csvFieldData,csvParam:this.csvParam},r=JSON.stringify(a);i.append("key1",r),i.append("_token",t.csrf_token),this.jq_csv_exin_msg.html("登録中です..."),jQuery.ajax({type:"POST",url:t.ajax_url,data:i,cache:!1,dataType:"text",processData:!1,contentType:!1}).done(((t,e)=>{var i;try{i=jQuery.parseJSON(t),console.log(i),location.reload(!0)}catch(e){return void this._errShow(t)}console.log(i)})).fail(((t,e,i)=>{this._errShow(t.responseText),alert(e)}))}_ampTo26(t){if("string"==typeof t)return-1!=t.indexOf("&")?t.replace(/&/g,"%26"):-1!=t.indexOf("%")?t.replace(/%/g,"%25"):t;if("object"==typeof t){for(var e in t)t[e]=this._ampTo26(t[e]);return t}return t}}
/**
 * 
 * 行入替機能
 * 
 * @note
 * テーブルの行を入れ替えることによる並べ替え
 * 
 * @version 2.0.0 Bootstrap4に対応
 * @since 2017-3-7 | 2022-7-8
 * @license MIT
 * 
 */class RowExchange{constructor(t,e,i,a){null==i&&(i={}),this.afterCallback=a,this.tbl=i.jqTbl,null==this.tbl&&(this.tbl=jQuery("#"+t)),this.data=e;var r="#exchange_tr_form_"+t;i.form_slt=r;var s=this._getFormHtml(r);this.tbl.after(s),this.form=jQuery(r),this.param=i,this.form.find(".exchange_tr_form_close").click((()=>{this.form.hide()})),this.form.find(".exchange_tr_btn").click((()=>{this._exchageTrReb()})),jQuery(r+" input").keypress((t=>{13==t.which&&this._exchageTrReb()})),this.form.find(".exchange_tr_shift_up").click((()=>{this._exchageTrShiftUp()})),this.form.find(".exchange_tr_shift_down").click((()=>{this._exchageTrShiftDown()}))}showForm(t){var e=jQuery(t),i=e.parents("tr").index();i+=1,this.param.from_row_index=i;var a=this.form.find(".exchange_tr_sort_no"),r=a.val();this._empty(r)&&a.val(i),this._showForm(this.form,e)}_exchageTrReb(){var t=this.param.from_row_index,e=this.form.find(".exchange_tr_sort_no").val();0!=this._checkRowIndex(e)&&t!=e&&this._exchageTr(t,e)}_exchageTrShiftUp(){var t=this.param.from_row_index,e=t-1;e<=0||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTrShiftDown(){var t=this.param.from_row_index,e=t+1;e>this.tbl.children("tbody").children("tr").length||(this._exchageTr(t,e),this.param.from_row_index=e)}_exchageTr(t,e){var i=this.tbl.find("tr").eq(t),a=this.tbl.find("tr").eq(e);t>e?jQuery(a).before(i):jQuery(a).after(i);let r=t-1,s=e-1,n=this.data[r].sort_no,l=this.data[s].sort_no;this.data[r].sort_no=l,this.data[s].sort_no=n,this.data=this._swapElementsOfArray(this.data,r,s),this.afterCallback&&this.afterCallback({from_row_index:t,to_row_index:e,from_index:r,to_index:s,data:this.data})}_swapElementsOfArray(t,e,i){if(e<0)throw Error("Error:220710A");if(e>=t.length)throw Error("Error:220710B");if(i<0)throw Error("Error:220710C");if(i>=t.length)throw Error("Error:220710D");let a=[],r=t[e],s=t[i];for(let n in t)n==e?a.push(s):n==i?a.push(r):a.push(t[n]);return a}_checkRowIndex(t){return null!=t&&(!!t.match(/^[0-9]*$/)&&!(t<=0))}_showForm(t,e,i){i||(i="auto"),t.show();var a=(e=jQuery(e)).offset(),r=a.left,s=a.top,n=jQuery(window).width(),l=t.outerWidth(),h=s+e.outerHeight(),c=0;switch(i){case"left":c=r-l;break;case"center":c=n/2-l/2;break;case"right":c=r;break;default:(c=r)+l>n&&(c=n-l)}c<0&&(c=0),t.offset({top:h,left:c})}_getFormHtml(t){var e=this._sltToCode(t);return"<div id='"+e+"_rap'>\t<div id='"+e+"' class='card' style='display:none;width:200px;background-color:white'>\t\t<div class='card-header bg-primary'>\t\t\t\t\t\t<div class='text-light' style='display:inline-block;width:60%'>行入替</div>\t\t\t<div class='text-light' style='display:inline-block;width:35%;text-align:right'>\t\t\t\t<button type='button' class='exchange_tr_form_close btn btn-primary btn-sm'  aria-label='閉じる'>\t\t\t\t\t<span class='oi' data-glyph='x'></span>\t\t\t\t</button>\t\t\t</div>\t\t</div>\t\t<div class='card-body' \">\t\t\t<button type='button' class='exchange_tr_shift_up btn btn-primary btn-sm' style='font-weight:bold;' title='一つ上に移動します。'><span class='oi' data-glyph='arrow-thick-top'></span></button>\t\t\t<button type='button' class='exchange_tr_shift_down btn btn-primary btn-sm' style='font-weight:bold;' title='一つ下に移動します。'><span class='oi' data-glyph='arrow-thick-bottom'></span></button>\t\t\t<div style='margin-top:20px'>\t\t\t\t<input class='exchange_tr_sort_no' type='number' style='width:60px' min='1' max='9999'  title='移動したい行の位置を数値で入力してください。先頭に移動させたい場合は1を入力して行入替ボタンを押します。上から3番目に移動させたい場合は3を入力します。' />\t\t\t\t<input type='button' value='行入替' class='exchange_tr_btn btn btn-warning btn-sm' />\t\t\t</div>\t\t</div>\t</div></div>"}_sltToCode(t){var e=t,i=e.charAt(0);return"#"!=i&&"."!=i||(e=e.substr(1)),e}_empty(t){return null==t||""==t||"0"==t||"object"==typeof t&&0==Object.keys(t).length}}class ShowModalBigImg{constructor(t){this.modalCat=this._createModalDiv();let e=this.modalCat.getContent();this.mdlImgElm=e.find("img"),this.jqElm=jQuery(t),this.jqElm.click((t=>{let e=$(t.currentTarget);return this._onClick(e),!1}))}_createModalDiv(){jQuery("body").prepend('<div id="show_modal_big_img_mdl" ><img src="" alt="" style="max-width:100%" /></div>');let t=new ModalCat_smbi;return t.modalize("show_modal_big_img_mdl"),t}_onClick(t){let e=t.attr("href"),i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="blob",i.onload=t=>{var i=t.target.response,a=window.URL.createObjectURL(i);this.mdlImgElm.attr("src",a),this.modalCat.open(),console.log(e)},i.send()}}
/**
 * モーダル化クラス
 * @since 2022-1-21
 * @version 1.0.0
 * @auther amaraimusi
 * @license MIT
 */class ModalCat_smbi{modalize(t){let e=t+"_js_main",i=t+"_js_modal_close",a=jQuery("#"+t);a.wrap(`<div id='${e}'></div>`);let r=jQuery("#"+e),s=`<div id='${i}'></div>`;r.prepend(s);let n=jQuery(r.find("#"+i));r.css({display:"none",height:"100vh",position:"fixed",top:"0",left:"0",width:"100vw"}),n.css({background:"rgba(0,0,0,0.8)",height:"100vh",position:"absolute",width:"100vw"}),a.css({background:"#fff",left:"50%",padding:"10px",position:"absolute",top:"50%",transform:"translate(-50%,-50%)",width:"60%"}),this.main=r,this.content=a,n.on("click",(()=>(this.main.fadeOut(),!1)))}open(){this.main.fadeIn()}close(){this.main.fadeOut()}getMainDiv(){return this.main}getContent(){return this.content}}